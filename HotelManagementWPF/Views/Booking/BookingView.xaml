<UserControl x:Class="HotelManagementWPF.Views.Booking.BookingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:HotelManagementWPF.ViewModels.Booking"
             xmlns:local="clr-namespace:HotelManagementWPF.Views.Booking"
             Background="White">

    <UserControl.Resources>

        <!-- Status to Background Converter -->
        
        <!-- Optimized Button Styles with Templates for Better Performance -->
        <Style x:Key="PillButton" TargetType="Button">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Foreground" Value="#2C3E50" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="20"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#F8F9FA"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#2C3E50"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E9ECEF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AddButton" TargetType="Button">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#3498DB" Offset="0"/>
                        <GradientStop Color="#2980B9" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="Margin" Value="8,0,0,0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="+" FontSize="16" FontWeight="Bold" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                <ContentPresenter VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#5DADE2" Offset="0"/>
                                            <GradientStop Color="#3498DB" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.02" ScaleY="1.02"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Three Dots Edit Button Style -->
        <Style x:Key="EditButton" TargetType="Button">
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="6">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Ellipse Width="3" Height="3" Fill="#95A5A6" Margin="0,1"/>
                                <Ellipse Width="3" Height="3" Fill="#95A5A6" Margin="0,1"/>
                                <Ellipse Width="3" Height="3" Fill="#95A5A6" Margin="0,1"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#F8F9FA"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.1" ScaleY="1.1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PageButton" TargetType="Button">
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Margin" Value="2,0" />
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#3498DB"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Optimized DataGrid Row Style -->
        <Style x:Key="ModernDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
            <Setter Property="BorderBrush" Value="#F0F0F0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0,12" />
            <Setter Property="Height" Value="56" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F8F9FA" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E3F2FD" />
                    <Setter Property="BorderBrush" Value="#2196F3" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern DataGrid Header Style -->
        <Style x:Key="ModernDataGridHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F8F9FA" />
            <Setter Property="Foreground" Value="#2C3E50" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="0,0,0,2" />
            <Setter Property="Height" Value="48" />
        </Style>

        <!-- Status Badge Styles -->
        <Style x:Key="StatusBadge" TargetType="Border">
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="MinWidth" Value="80" />
        </Style>

        <!-- Search TextBox Style -->
        <Style x:Key="SearchTextBox" TargetType="TextBox">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Margin" Value="0,0,12,0"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="250"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="8">
                            <Grid>
                                <!-- Search Icon -->
                                <Path Fill="#95A5A6"
                                      Margin="12,0,0,0"
                                      HorizontalAlignment="Left"
                                      VerticalAlignment="Center"
                                      Width="16" Height="16"
                                      Stretch="Fill"
                                      Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>

                                <!-- Placeholder Text -->
                                <TextBlock x:Name="PlaceholderText"
                                         Text="Search bookings by guest, room, or status..."
                                         Foreground="#95A5A6"
                                         VerticalAlignment="Center"
                                         Margin="40,0,12,0"
                                         IsHitTestVisible="False"
                                         Visibility="Visible"/>

                                <!-- Text Input Area -->
                                <ScrollViewer x:Name="PART_ContentHost"
                                            Focusable="False"
                                            HorizontalScrollBarVisibility="Hidden"
                                            VerticalScrollBarVisibility="Hidden"
                                            Margin="40,8,12,8"
                                            VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#3498DB"/>
                                <Setter TargetName="PlaceholderText" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#3498DB"/>
                            </Trigger>
                            <!-- Hide placeholder when text is not empty -->
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="PlaceholderText" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <!-- Main Content -->
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>



        <!-- Filter and Action Header -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="12"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Enhanced Filter Buttons -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                <Button Style="{StaticResource PillButton}" 
                        Command="{Binding FilterCommand}" 
                        CommandParameter="All">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#95A5A6" Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding TotalBookings, StringFormat=All ({0})}" FontWeight="Medium"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource PillButton}" 
                        Command="{Binding FilterCommand}" 
                        CommandParameter="Active">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#27AE60" Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding ActiveBookings, StringFormat=Active ({0})}" FontWeight="Medium"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource PillButton}" 
                        Command="{Binding FilterCommand}" 
                        CommandParameter="Completed">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#3498DB" Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding CompletedBookings, StringFormat=Completed ({0})}" FontWeight="Medium"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource PillButton}" 
                        Command="{Binding FilterCommand}" 
                        CommandParameter="Cancelled">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#E74C3C" Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding CancelledBookings, StringFormat=Cancelled ({0})}" FontWeight="Medium"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Search and Add Button Row -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <TextBox Grid.Column="0" 
                         Style="{StaticResource SearchTextBox}"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         HorizontalAlignment="Left"/>

                <!-- Enhanced Add Button -->
                <Button Grid.Column="1" 
                        Style="{StaticResource AddButton}" 
                        Command="{Binding AddBookingCommand}"
                        HorizontalAlignment="Right">
                    <TextBlock Text="Add New Booking" FontSize="13"/>
                </Button>
            </Grid>
        </Grid>

        <!-- Optimized DataGrid with Virtualization -->
        <Border Grid.Row="2" 
                Background="White" 
                BorderBrush="#E0E0E0" 
                BorderThickness="1" 
                CornerRadius="8"
                Margin="0,0,0,16">
            <DataGrid ItemsSource="{Binding PaginatedBookings}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      RowHeaderWidth="0"
                      SelectionMode="Single"
                      HeadersVisibility="Column"
                      GridLinesVisibility="None"
                      BorderThickness="0"
                      Background="Transparent"
                      RowBackground="Transparent"
                      AlternatingRowBackground="Transparent"
                      RowStyle="{StaticResource ModernDataGridRow}"
                      ColumnHeaderStyle="{StaticResource ModernDataGridHeader}"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      VirtualizingPanel.IsVirtualizing="True"
                      ScrollViewer.CanContentScroll="True">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Guest" 
                                      Binding="{Binding Guest}" 
                                      Width="2*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="14"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="#2C3E50"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Margin" Value="16,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Room" 
                                      Binding="{Binding Room}" 
                                      Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="13"/>
                                <Setter Property="Foreground" Value="#5D6D7E"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Margin" Value="16,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Check-in" 
                                      Binding="{Binding CheckInFormatted}" 
                                      Width="1.5*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="13"/>
                                <Setter Property="Foreground" Value="#5D6D7E"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Margin" Value="16,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Check-out" 
                                      Binding="{Binding CheckOutFormatted}" 
                                      Width="1.5*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="13"/>
                                <Setter Property="Foreground" Value="#5D6D7E"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Margin" Value="16,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="Status" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource StatusBadge}"
                                        Margin="16,0">
                                    <TextBlock Text="{Binding Status}" 
                                             FontWeight="SemiBold" 
                                             FontSize="12" 
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Edit Button Column -->
                    <DataGridTemplateColumn Header="Actions" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Style="{StaticResource EditButton}"
                                        CommandParameter="{Binding}"
                                        ToolTip="Edit Booking"
                                        Margin="16,0"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Enhanced Pagination -->
        <Grid Grid.Row="3" HorizontalAlignment="Center" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" 
                    Style="{StaticResource PageButton}" 
                    Command="{Binding PreviousPageCommand}"
                    Margin="0,0,12,0">
                <TextBlock Text="&lt;" FontSize="16" FontWeight="Bold"/>
            </Button>

            <ItemsControl Grid.Column="1" 
                          ItemsSource="{Binding PageNumbers}" 
                          HorizontalAlignment="Center">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Style="{StaticResource PageButton}" 
                                Command="{Binding DataContext.GoToPageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                CommandParameter="{Binding}">
                            <TextBlock Text="{Binding}" 
                                     HorizontalAlignment="Center" 
                                     VerticalAlignment="Center" 
                                     FontWeight="Medium"/>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Button Grid.Column="2" 
                    Style="{StaticResource PageButton}" 
                    Command="{Binding NextPageCommand}"
                    Margin="12,0,0,0">
                <TextBlock Text="&gt;" FontSize="16" FontWeight="Bold"/>
            </Button>
        </Grid>
    </Grid>
</UserControl>